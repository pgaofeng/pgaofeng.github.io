<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta content="width=device-width,initial-scale=1,minimum-scale=1" name="viewport"><meta content="ie=edge" http-equiv="X-UA-Compatible"><meta content="#fff" name="theme-color" id="theme-color"><meta content="Hexo" name="description"><link href="/img/website.svg" rel="icon"><title>在Ubuntu上下载AOSP并编译Android13</title><link href="/css/main.css" rel="preload" as="style"><link href="/css/main.css" rel="stylesheet"><link href="/css/libs/atom-one-light.min.css" rel="preload" as="style"><link href="/css/libs/atom-one-light.min.css" rel="stylesheet"><script>function loadScript(e,t){var n=document.createElement("script");n.src=e,t&&(n.onload=t),n.async=!0,document.body.appendChild(n)}function loadCSS(e){var t=document.createElement("link");t.ref="stylesheet",t.href=e,document.head.appendChild(t)}function changeCSS(e,t,n){var t=document.querySelector(t),c=document.createElement("link");c.setAttribute("rel","stylesheet"),c.setAttribute("href",e),c.dataset.prism=n,document.head.replaceChild(c,t)}</script><link href="/js/lib/lozad.min.js" rel="preload" as="script"><meta content="Hexo 8.1.1" name="generator"></head><body><div class="wrapper"><nav class="navbar"><div class="nav-container"><div class="navbar-menu"><a href="/" class="navbar-menu-item">首页 </a><a href="/archives" class="navbar-menu-item">归档 </a><a href="/tags" class="navbar-menu-item">标签 </a><a href="/categories" class="navbar-menu-item">分类</a></div></div></nav><div class="section-wrap"><div class="container"><div class="columns"><aside class="left-column"><div class="card card-author"><img alt="author avatar" class="author-img" src="/img/website.svg" height="88" width="88"><p class="author-name">pppeng</p><p class="author-description">一日不书 百事荒芜</p><div class="author-message"><a href="/archives" class="author-posts-count"><span>41</span> <span>文章</span> </a><a href="/categories" class="author-categories-count"><span>6</span> <span>分类</span> </a><a href="/tags" class="author-tags-count"><span>19</span> <span>标签</span> </a><a class="author-word-count"><span>16.39</span> <span>万字</span></a></div></div><div class="sticky-tablet"><article class="display-when-two-columns spacer"><div class="card card-content toc-card"><div class="toc-header">目录</div><ol class="toc"><li class="toc-item toc-level-2"><a href="#%E7%BC%96%E8%AF%91%E7%8E%AF%E5%A2%83" class="toc-link"><span class="toc-text">编译环境</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a href="#%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83" class="toc-link"><span class="toc-text">配置环境</span></a></li><li class="toc-item toc-level-3"><a href="#%E6%BA%90%E7%A0%81%E4%B8%8B%E8%BD%BD" class="toc-link"><span class="toc-text">源码下载</span></a></li><li class="toc-item toc-level-3"><a href="#%E7%BC%96%E8%AF%91%E7%B3%BB%E7%BB%9F" class="toc-link"><span class="toc-text">编译系统</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a href="#%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%B7%91%E4%B8%8D%E6%BB%A1cpu" class="toc-link"><span class="toc-text">虚拟机跑不满cpu</span></a></li><li class="toc-item toc-level-4"><a href="#%E7%BC%96%E8%AF%91%E6%8A%A5%E9%94%99ninja-137" class="toc-link"><span class="toc-text">编译报错ninja 137</span></a></li></ol></li><li class="toc-item toc-level-3"><a href="#%E8%BF%90%E8%A1%8C%E6%A8%A1%E6%8B%9F%E5%99%A8" class="toc-link"><span class="toc-text">运行模拟器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a href="#%E6%97%A0%E6%B3%95%E5%90%AF%E5%8A%A8%E8%99%9A%E6%8B%9F%E6%9C%BA" class="toc-link"><span class="toc-text">无法启动虚拟机</span></a></li></ol></li></ol></li></ol></div></article><article class="card card-content categories-widget"><div class="categories-card"><div class="categories-header">分类</div><div class="categories-list"><a href="/categories/Android-Framework/"><div class="categories-list-item">Android Framework <span class="categories-list-item-badge">12</span></div></a><a href="/categories/Android-View/"><div class="categories-list-item">Android View <span class="categories-list-item-badge">4</span></div></a><a href="/categories/Third-Libraries/"><div class="categories-list-item">Third Libraries <span class="categories-list-item-badge">11</span></div></a><a href="/categories/Kotlin/"><div class="categories-list-item">Kotlin <span class="categories-list-item-badge">6</span></div></a><a href="/categories/Flutter/"><div class="categories-list-item">Flutter <span class="categories-list-item-badge">6</span></div></a><a href="/categories/Java/"><div class="categories-list-item">Java <span class="categories-list-item-badge">2</span></div></a></div></div></article></div></aside><main class="main-column"><div class="image-wrapper"><img alt="在Ubuntu上下载AOSP并编译Android13 thumbnail" class="lozad image" src="/img/cover/cover-aosp.webp" data-src="</%= page.banner_img " srcset="data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPSc4MDAnIGhlaWdodD0nMjQwJz48cmVjdCB4PScwJyB5PScwJyB3aWR0aD0nODAwJyBoZWlnaHQ9JzI0MCcgZmlsbD0nI2ZhZmFmYScvPjx0ZXh0IHg9JzUwJScgeT0nNTAlJyBzdHlsZT0nZG9taW5hbnQtYmFzZWxpbmU6bWlkZGxlO3RleHQtYW5jaG9yOm1pZGRsZTtmb250LXNpemU6NTNweCcgZmlsbD0nI2I3YjdiNyc+5Zu+54mH5Yqg6L295LitPC90ZXh0Pjwvc3ZnPg=="></div><article class="card card-content article-content"><header><h1 class="post-title">在Ubuntu上下载AOSP并编译Android13</h1></header><div class="post-meta post-show-meta"><time datetime="2022-01-11T13:44:23.000Z"><i class="icon-calendar iconfont" style="margin-right:2px"></i> <span>2022-01-11</span> </time><span class="dot"></span> <a href="/categories/Android-Framework/" class="post-meta-link">Android Framework </a><span class="dot"></span> <span>约2.3k 字</span></div><div class="post-content" id="section"><p><code>AOSP</code>即是<code>Android</code>的开源项目，包含了<code>Android的</code>所有源码，可通过<code>AOSP</code>编译出<code>Android</code>系统，然后刷写到实际设备中或者运行在模拟器中。对于我们的学习而言，我们也可以下载源码进行阅读，研究其设计逻辑。当然，也有很多的在线源码阅读网站可以阅读<code>Android</code>源码，但如果需要调试的话，还是本地下载比较合适。</p><h2 id="编译环境"><a href="#编译环境" class="headerlink" title="编译环境"></a>编译环境</h2><p>目前<code>Android</code>官网已经不在支持<code>MacOS</code>上编译源码了，需要使用<code>Linux</code>进行编译。这里使用的是<code>VMWare</code>虚拟机下的<code>Ubuntu 22.04</code>作为编译环境。虚拟机从官网下载，目前最新的虚拟机已经免费，不需要在找破解版了，直接官网下载最新的即可。<a href="https://releases.ubuntu.com/" rel="noopener" target="_blank">Ubuntu下载</a>从官网下载即可，这里选的是22.04的版本，也可以选最新的版本。</p><p>创建虚拟机的时候，最好将虚拟机的核数设置为和实际<code>cpu</code>一致，以便完全利用<code>cpu</code>编译。同时存储空间需要<code>500g</code>，内存也尽量调整的大一些，加上交换空间最好要有<code>32g</code>。</p><h3 id="配置环境"><a href="#配置环境" class="headerlink" title="配置环境"></a>配置环境</h3><p>编译源码还需要安装一些软件和库，由于下载速度较慢，所以需要先将下载源切换到国内的源。这里配置的是<a href="https://mirror.tuna.tsinghua.edu.cn/help/ubuntu/" rel="noopener" target="_blank">清华源</a>。配置文件是<code>/etc/apt/sources.list</code></p><figure class="bash highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="bash hljs"><span class="hljs-comment"># 备份原仓库配置文件</span><br><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">cp</span> /etc/apt/sources.list /etc/apt/sources.list.bak<br><span class="hljs-comment"># 修改配置文件</span><br><span class="hljs-built_in">sudo</span> gedit /etc/apt/sources.list<br></code></pre></td></tr></table></figure><p>然后将以下内容输入文件中。</p><figure class="bash highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="bash hljs"><span class="hljs-comment"># 默认注释了源码镜像以提高 apt update 速度，如有需要可自行取消注释</span><br>deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy main restricted universe multiverse<br><span class="hljs-comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy main restricted universe multiverse</span><br>deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-updates main restricted universe multiverse<br><span class="hljs-comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-updates main restricted universe multiverse</span><br>deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-backports main restricted universe multiverse<br><span class="hljs-comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-backports main restricted universe multiverse</span><br><br><span class="hljs-comment"># 以下安全更新软件源包含了官方源与镜像站配置，如有需要可自行修改注释切换</span><br>deb http://security.ubuntu.com/ubuntu/ jammy-security main restricted universe multiverse<br><span class="hljs-comment"># deb-src http://security.ubuntu.com/ubuntu/ jammy-security main restricted universe multiverse</span><br><br><span class="hljs-comment"># 预发布软件源，不建议启用</span><br><span class="hljs-comment"># deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-proposed main restricted universe multiverse</span><br><span class="hljs-comment"># # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-proposed main restricted universe multiverse</span><br></code></pre></td></tr></table></figure><p>然后执行以下命令更新源并下载所需的软件。第三条命令是下载编译源码所必须的软件和库，不过大部分的软件在系统中默认都是已经有了的，只有部分需要下载。参考：<a href="https://source.android.com/docs/setup/start/initializing?hl=zh-cn#setting-up-a-linux-build-environment" rel="noopener" target="_blank">官网环境配置</a></p><figure class="bash highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="bash hljs"><span class="hljs-comment"># 更新源</span><br><span class="hljs-built_in">sudo</span> apt update<br><span class="hljs-built_in">sudo</span> apt upgrade<br><span class="hljs-comment"># 下载编译必须的库</span><br><span class="hljs-built_in">sudo</span> apt install git gnupg flex bison build-essential zip curl zlib1g-dev libc6-dev-i386 libncurses5 ib32ncurses-dev x11proto-core-dev libx11-dev lib32z1-dev libgl1-mesa-dev libxml2-utils xsltproc unzip fontconfig<br><span class="hljs-comment"># 安装vim，不习惯用vim可以不用安装，直接用自带的gedit也一样</span><br><span class="hljs-built_in">sudo</span> apt install vim<br><span class="hljs-comment"># 配置git</span><br>git config --global user.name pppeng<br>git config --global user.email xxxx@163.com<br></code></pre></td></tr></table></figure><p>下载<code>repo</code>，这里下载的不是谷歌的repo，而是清华源的，方便国内访问。</p><figure class="bash highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="bash hljs"><span class="hljs-built_in">mkdir</span> ~/bin<br>PATH=~/bin:<span class="hljs-variable">$PATH</span><br>curl https://mirrors.tuna.tsinghua.edu.cn/git/git-repo -o repo &gt; ~/bin/repo<br><span class="hljs-built_in">chmod</span> a+x ~/bin/repo<br><br><span class="hljs-comment"># 修改repo的更新源</span><br><span class="hljs-built_in">sudo</span> gedit ~/.bashrc<br><span class="hljs-comment"># 然后在该文件的最后添加这一行</span><br><span class="hljs-built_in">export</span> REPO_URL=<span class="hljs-string">&#x27;https://mirrors.tuna.tsinghua.edu.cn/git/git-repo&#x27;</span><br></code></pre></td></tr></table></figure><h3 id="源码下载"><a href="#源码下载" class="headerlink" title="源码下载"></a>源码下载</h3><p>源码下载需要梯子，不然无法下载到。这里使用的清华源的<code>AOSP</code>，不需要梯子，并且下载速度也挺快的，具体链接：<a href="https://mirror.tuna.tsinghua.edu.cn/help/AOSP/" rel="noopener" target="_blank">清华源AOSP</a>。就是可以先下载<code>aosp-latest.tar</code>的初始包压缩包，然后再同步到最新代码，这样操作下来是比较快的，比直接同步所有源码速度快一些。</p><figure class="bash highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="bash hljs"><span class="hljs-comment"># 下载aosp-latest.tar</span><br>curl -OC - https://mirrors.tuna.tsinghua.edu.cn/aosp-monthly/aosp-latest.tar<br><br><span class="hljs-comment"># 或者直接在虚拟机浏览器上下载或者别的方式进行下载都可以，注意不要直接在宿主机上下载，不然</span><br><span class="hljs-comment"># 同步到虚拟机上很麻烦，因为文件太大了。。</span><br></code></pre></td></tr></table></figure><p>下载完初始包之后切换下分支，然后同步到最新的代码即可。分支可以从官网查询，需要梯子：<a href="https://source.android.com/docs/setup/about/build-numbers?hl=zh-cn#source-code-tags-and-builds" rel="noopener" target="_blank">Build ID查询</a></p><figure class="bash highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="bash hljs">tar -xvf aosp-latest.tar<br><span class="hljs-comment"># 进入解压后得到的aosp目录</span><br><span class="hljs-built_in">cd</span> AOSP<br><span class="hljs-comment"># 切换分支，这里选的Android13的最新版本</span><br>repo init -u https://mirrors.tuna.tsinghua.edu.cn/git/AOSP/platform/manifest -b android-13.0.0_r44<br><span class="hljs-comment"># 重置下repo，不然可能会导致下载失败</span><br><span class="hljs-built_in">cd</span> .repo/repo<br>git fetch -all<br>git reset --hard origin/stable<br>git pull<br><span class="hljs-comment"># 回到aosp目录</span><br><span class="hljs-built_in">cd</span> ../../<br><span class="hljs-comment"># 同步源码，时间挺久的，不过下载中断也没关系，后续直接repo sync就会接着下载了</span><br>repo <span class="hljs-built_in">sync</span><br></code></pre></td></tr></table></figure><h3 id="编译系统"><a href="#编译系统" class="headerlink" title="编译系统"></a>编译系统</h3><p>同步完成后进入到<code>aosp</code>目录后，可以看到源码已经存在了。直接输入<code>source build/envsetup.sh</code>配置下编译环境，然后输入<code>lunch</code>选择编译目标。最终会输出一大堆的带编号的目标，如果想在模拟器上查看编译的系统的话，选择输入<code>sdk_phone_x86_64-eng</code>，或者输入对应的编码数字也是可以的（这里不会全部列出来，所以可能输出的列表中没有这个选项）。然后输入<code>m</code>即可进行编译。</p><p>编译时不要输入<code>m -j16</code>这种，而是单纯的<code>m</code>，让其根据你的<code>CPU</code>来自动选择并发的任务数。</p><figure class="bash highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="bash hljs"><span class="hljs-built_in">cd</span> AOSP<br><span class="hljs-built_in">source</span> build/envsetup.sh<br>lunch sdk_phone_x86_64-eng<br>m<br></code></pre></td></tr></table></figure><p>根据需要选择lunch的目标，这里一定要选择好，毕竟编译一次需要耗费一个多小时。。。注意每次切换后最好执行下<code>make clean</code>，我就因为没有clean导致了出现莫名其妙的问题，排查老半天了。</p><h4 id="虚拟机跑不满cpu"><a href="#虚拟机跑不满cpu" class="headerlink" title="虚拟机跑不满cpu"></a>虚拟机跑不满cpu</h4><p>编译时打开<code>window</code>的任务管理器，可以看到<code>CPU</code>的利用率并没有达到<code>100%</code>，当然这也是没问题的，只是会编译的比较慢而已。解决方法是在<code>windows</code>上打开<code>设置-系统-电源-电源模式</code>，然后设置为<strong>最佳性能</strong>。再重新编译，打开任务管理器可以看到cpu跑到100%了。</p><h4 id="编译报错ninja-137"><a href="#编译报错ninja-137" class="headerlink" title="编译报错ninja 137"></a>编译报错ninja 137</h4><figure class="bash highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="bash hljs">============================================<br>14:18:27 ninja failed with: <span class="hljs-built_in">exit</span> status 137<br><br><span class="hljs-comment">#### failed to build some targets (01:24 (mm:ss)) ####</span><br></code></pre></td></tr></table></figure><p>编译时基本上没有别的提示，就一句失败了，然后错误码137。这种137的错误码通常都是内存不足导致的，可以看编译日志进行确认，输入<code>tail out/soong.log</code></p><figure class="bash highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="bash hljs">14:17:11.518992 build/soong/ui/build/exec.go:64: <span class="hljs-string">&quot;ninja&quot;</span> executing <span class="hljs-string">&quot;prebuilts/build-tools/linux-x86/bin/nsjail&quot;</span> [-x prebuilts/build-tools/linux-x86/bin/ninja -H android-build --cwd /home/feng/Desktop/aosp -t 0 -e --proc_rw -u nobody -g nogroup --rlimit_as soft --rlimit_core soft --rlimit_cpu soft --rlimit_fsize soft --rlimit_nofile soft -R / -B /tmp -B /home/feng/Desktop/aosp -B /home/feng/Desktop/aosp/out --disable_clone_newcgroup -q -- -d keepdepfile -d keeprsp -d stats --frontend_file out/.ninja_fifo droid -j 18 -f out/combined-aosp_arm.ninja -o usesphonyoutputs=<span class="hljs-built_in">yes</span> -w dupbuild=err -w missingdepfile=err]<br>14:18:27.593425 build/soong/ui/build/exec.go:74: <span class="hljs-string">&quot;ninja&quot;</span> finished with <span class="hljs-built_in">exit</span> code 137 (1m16.073s real, 23.135s user, 42.786s system, 11217MB maxrss)<br>14:18:27.600733 build/soong/ui/build/exec.go:127: ninja failed with: <span class="hljs-built_in">exit</span> status 137<br></code></pre></td></tr></table></figure><p>首先需要通过<code>out/soong.log</code>查看具体的报错信息，然后排查是谁发生异常。这里实际也没有任何信息，只显示了退出时<code>ninja</code>的错误码是137。然后查下系统log：<code>cat /var/log/syslog | grep ninja</code></p><figure class="bash highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="bash hljs">14:18:25 ubuntu kernel: [ 6902.917239] Out of memory: Killed process 21126 (ninja) total-vm:5222380kB, anon-rss:3099840kB, file-rss:0kB, shmem-rss:0kB, UID:1000 pgtables:9260kB oom_score_adj:0<br></code></pre></td></tr></table></figure><p>可以看到相关的结果是<code>Out of memory</code>导致的<code>ninja</code>被杀死，因此可以判定为内存不足导致的。查看虚拟机内存输入<code>free -h</code>，我这边显示的是24g的内存，2g的交换内存，仍然是不够编译的，需要至少<code>32g</code>的内存。可以通过增加交换内存来达到32g。</p><figure class="bash highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="bash hljs"><span class="hljs-comment"># 禁用当前交换空间</span><br><span class="hljs-built_in">sudo</span> swapoff -a<br><span class="hljs-comment"># 创建新的大小，改成12g，可以根据实际需要调整大小。加上内存最好能达到32g以上</span><br><span class="hljs-built_in">sudo</span> fallocate -l 12g /swapfile<br><span class="hljs-comment"># 设置交换空间</span><br><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">chmod</span> 600 /swapfile<br><span class="hljs-built_in">sudo</span> mkswap /swapfile<br><span class="hljs-built_in">sudo</span> swapon /swapfile<br><br><span class="hljs-comment"># 查看是否设置成功</span><br>free -h<br></code></pre></td></tr></table></figure><h3 id="运行模拟器"><a href="#运行模拟器" class="headerlink" title="运行模拟器"></a>运行模拟器</h3><p>编译成功之后直接输入<code>emulator</code>即可运行模拟器，如果提示没有这个命令的话，说明是环境有问题，或者<code>lunch</code>的选项不对。可以输入以下命令重新进行编译：</p><figure class="bash highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="bash hljs"><span class="hljs-comment"># 进入到AOSP的目录</span><br><span class="hljs-built_in">cd</span> AOSP<br><span class="hljs-built_in">source</span> build/envsetup.sh<br><span class="hljs-comment"># 或者直接输入lunch，然后在输入sdk_phone_x86_64-eng</span><br>lunch sdk_phone_x86_64-eng<br><span class="hljs-comment"># 编译</span><br>m<br><span class="hljs-comment"># 编译成功运行模拟器</span><br>emulator<br></code></pre></td></tr></table></figure><h4 id="无法启动虚拟机"><a href="#无法启动虚拟机" class="headerlink" title="无法启动虚拟机"></a>无法启动虚拟机</h4><figure class="bash highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="bash hljs">ERROR: x86_64 emulation currently requires hardware acceleration!<br></code></pre></td></tr></table></figure><p>编译成功之后，可以直接运行<code>emulator</code>启动虚拟机，可能会遇到以上的报错信息，解决方案：</p><ol><li>关闭虚拟机，然后在<code>虚拟机-设置-处理器</code>的地方，底下有个虚拟化引擎，将第一个虚拟化<code>Intel VT-x/EPT或AMD-V/RVI(V)</code>勾选，然后确定即可</li><li>按<code>win</code>键搜索<code>内核隔离</code>，然后将该选项关闭，不然无法打开虚拟机</li></ol><p>执行以上两步操作后，再输入<code>emulator</code>即可成功开启虚拟机了。</p><p><img alt="虚拟机" class="lozad post-image" src="/img/emulator.webp" data-src="/img/emulator.webp" srcset="data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPSc4MDAnIGhlaWdodD0nMjQwJz48cmVjdCB4PScwJyB5PScwJyB3aWR0aD0nODAwJyBoZWlnaHQ9JzI0MCcgZmlsbD0nI2ZhZmFmYScvPjx0ZXh0IHg9JzUwJScgeT0nNTAlJyBzdHlsZT0nZG9taW5hbnQtYmFzZWxpbmU6bWlkZGxlO3RleHQtYW5jaG9yOm1pZGRsZTtmb250LXNpemU6NTNweCcgZmlsbD0nI2I3YjdiNyc+5Zu+54mH5Yqg6L295LitPC90ZXh0Pjwvc3ZnPg=="></p></div></article><div><div class="copyright note-warning post-note"><p></p><div class="post-data">本文发布于<span id="post-time"></span>天前，最后更新于<span id="update-time"></span>天前，内容可能会与最新版本有所差异。</div><script>document.addEventListener("DOMContentLoaded",function(){var e=new Date,t=new Date("Tue Jan 11 2022 21:44:23 GMT+0800");let n="Tue Jan 11 2022 21:44:23 GMT+0800";n="2024-07-15 21:22:58 +0800";var a=new Date(n),t=Math.floor((e-t)/864e5),e=Math.floor((e-a)/864e5);document.getElementById("post-time").innerText=t,document.getElementById("update-time").innerText=e})</script><p></p></div></div><div class="post-footer"><a href="/categories/Android-Framework/" class="post-footer-category">#&nbsp;Android Framework</a> <a href="/tags/AOSP/" class="post-footer-tag">#&nbsp;AOSP</a></div><div class="nav"><div class="nav-item-prev"><a href="/2022/02/23/eventfd-epoll/" class="nav-link"><div><div class="nav-label">上一篇</div><div class="nav-title">Handler唤起的基础--eventfd和epoll</div></div></a></div><div class="nav-item-next"><a href="/2021/11/22/android-scrolling-nested/" class="nav-link"><div><div class="nav-label">下一篇</div><div class="nav-title">Android滑动事件之嵌套滑动</div></div></a></div></div><div class="card card-content toc-card" id="mobiletoc"><div class="toc-header">目录</div><ol class="toc"><li class="toc-item toc-level-2"><a href="#%E7%BC%96%E8%AF%91%E7%8E%AF%E5%A2%83" class="toc-link"><span class="toc-text">编译环境</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a href="#%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83" class="toc-link"><span class="toc-text">配置环境</span></a></li><li class="toc-item toc-level-3"><a href="#%E6%BA%90%E7%A0%81%E4%B8%8B%E8%BD%BD" class="toc-link"><span class="toc-text">源码下载</span></a></li><li class="toc-item toc-level-3"><a href="#%E7%BC%96%E8%AF%91%E7%B3%BB%E7%BB%9F" class="toc-link"><span class="toc-text">编译系统</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a href="#%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%B7%91%E4%B8%8D%E6%BB%A1cpu" class="toc-link"><span class="toc-text">虚拟机跑不满cpu</span></a></li><li class="toc-item toc-level-4"><a href="#%E7%BC%96%E8%AF%91%E6%8A%A5%E9%94%99ninja-137" class="toc-link"><span class="toc-text">编译报错ninja 137</span></a></li></ol></li><li class="toc-item toc-level-3"><a href="#%E8%BF%90%E8%A1%8C%E6%A8%A1%E6%8B%9F%E5%99%A8" class="toc-link"><span class="toc-text">运行模拟器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a href="#%E6%97%A0%E6%B3%95%E5%90%AF%E5%8A%A8%E8%99%9A%E6%8B%9F%E6%9C%BA" class="toc-link"><span class="toc-text">无法启动虚拟机</span></a></li></ol></li></ol></li></ol></div></main><aside class="right-column"><div class="sticky-widescreen"><article class="card card-content"><div class="recent-posts-card"><div class="recent-posts-header">相关文章</div><div class="recent-posts-list"><div class="recent-posts-item"><div class="recent-posts-item-title">2022-10-02</div><a href="/2022/10/02/ams/"><div class="recent-posts-item-content">App管理服务-ActivityManagerService</div></a></div><div class="recent-posts-item recent-posts-item-other"><div class="recent-posts-item-title">2022-09-21</div><a href="/2022/09/21/system_server/"><div class="recent-posts-item-content">Java服务总管-system_server进程</div></a></div><div class="recent-posts-item recent-posts-item-other"><div class="recent-posts-item-title">2022-08-12</div><a href="/2022/08/12/zygote/"><div class="recent-posts-item-content">Java进程祖先-zygote服务</div></a></div><div class="recent-posts-item recent-posts-item-other"><div class="recent-posts-item-title">2022-07-25</div><a href="/2022/07/25/logd/"><div class="recent-posts-item-content">Android logd日志服务</div></a></div><div class="recent-posts-item recent-posts-item-other"><div class="recent-posts-item-title">2022-06-03</div><a href="/2022/06/03/init/"><div class="recent-posts-item-content">Android Init进程</div></a></div></div></div></article><article class="card card-content"><div class="recent-posts-card"><div class="recent-posts-header">最近文章</div><div class="recent-posts-list"><div class="recent-posts-item"><div class="recent-posts-item-title">2024-09-10</div><a href="/2024/09/10/flutter-state/"><div class="recent-posts-item-content">Flutter状态管理</div></a></div><div class="recent-posts-item recent-posts-item-other"><div class="recent-posts-item-title">2024-08-16</div><a href="/2024/08/16/flutter-canvas/"><div class="recent-posts-item-content">Flutter自定义绘制CustomPaint</div></a></div><div class="recent-posts-item recent-posts-item-other"><div class="recent-posts-item-title">2024-07-23</div><a href="/2024/07/23/flutter-getx/"><div class="recent-posts-item-content">Flutter强大脚手架-GetX</div></a></div><div class="recent-posts-item recent-posts-item-other"><div class="recent-posts-item-title">2024-06-16</div><a href="/2024/06/16/flutter-navigator/"><div class="recent-posts-item-content">Flutter界面跳转-Navigator</div></a></div></div></div></article></div></aside></div></div></div></div><script>let initCount=0;function initClipboard(){++initCount<2||new ClipboardJS(".btn-copy").on("success",function(n){n.clearSelection(),n.trigger.innerHTML=icon_yes,setTimeout(()=>{n.trigger.innerHTML=icon_copy},1e3)})}var addLazyload=function(){lozad(".lozad",{load:function(n){n.srcset=n.getAttribute("data-src")},loaded:function(n){n.classList.add("loaded")}}).observe()}</script><script>loadScript("/js/lib/lozad.min.js",addLazyload)</script><script>loadScript("/js/lib/toc-highlight-scroll.min.js",()=>{tocSetup(),addCopyButton(),initClipboard()})</script><script>loadScript("/js/lib/clipboard.min.js",()=>initClipboard())</script></body></html>