<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta content="width=device-width,initial-scale=1,minimum-scale=1" name="viewport"><meta content="ie=edge" http-equiv="X-UA-Compatible"><meta content="#fff" name="theme-color" id="theme-color"><meta content="Hexo" name="description"><link href="/img/website.svg" rel="icon"><title>FFmpeg编译so库文件</title><link href="/css/main.css" rel="preload" as="style"><link href="/css/main.css" rel="stylesheet"><link href="/css/libs/atom-one-light.min.css" rel="preload" as="style"><link href="/css/libs/atom-one-light.min.css" rel="stylesheet"><script>function loadScript(e,t){var n=document.createElement("script");n.src=e,t&&(n.onload=t),n.async=!0,document.body.appendChild(n)}function loadCSS(e){var t=document.createElement("link");t.ref="stylesheet",t.href=e,document.head.appendChild(t)}function changeCSS(e,t,n){var t=document.querySelector(t),c=document.createElement("link");c.setAttribute("rel","stylesheet"),c.setAttribute("href",e),c.dataset.prism=n,document.head.replaceChild(c,t)}</script><link href="/js/lib/lozad.min.js" rel="preload" as="script"><meta content="Hexo 8.1.1" name="generator"></head><body><div class="wrapper"><nav class="navbar"><div class="nav-container"><div class="navbar-menu"><a href="/" class="navbar-menu-item">首页 </a><a href="/archives" class="navbar-menu-item">归档 </a><a href="/tags" class="navbar-menu-item">标签 </a><a href="/categories" class="navbar-menu-item">分类</a></div></div></nav><div class="section-wrap"><div class="container"><div class="columns"><aside class="left-column"><div class="card card-author"><img alt="author avatar" class="author-img" src="/img/website.svg" height="88" width="88"><p class="author-name">pppeng</p><p class="author-description">一日不书 百事荒芜</p><div class="author-message"><a href="/archives" class="author-posts-count"><span>41</span> <span>文章</span> </a><a href="/categories" class="author-categories-count"><span>6</span> <span>分类</span> </a><a href="/tags" class="author-tags-count"><span>19</span> <span>标签</span> </a><a class="author-word-count"><span>16.39</span> <span>万字</span></a></div></div><div class="sticky-tablet"><article class="display-when-two-columns spacer"><div class="card card-content toc-card"><div class="toc-header">目录</div><ol class="toc"><li class="toc-item toc-level-3"><a href="#FFmpeg%E7%9A%84%E7%BC%96%E8%AF%91" class="toc-link"><span class="toc-text">FFmpeg的编译</span></a></li><li class="toc-item toc-level-3"><a href="#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E" class="toc-link"><span class="toc-text">参数说明</span></a></li><li class="toc-item toc-level-3"><a href="#%E5%BC%95%E5%85%A5%E5%88%B0%E5%AE%89%E5%8D%93%E4%B8%AD" class="toc-link"><span class="toc-text">引入到安卓中</span></a></li></ol></div></article><article class="card card-content categories-widget"><div class="categories-card"><div class="categories-header">分类</div><div class="categories-list"><a href="/categories/Android-Framework/"><div class="categories-list-item">Android Framework <span class="categories-list-item-badge">12</span></div></a><a href="/categories/Android-View/"><div class="categories-list-item">Android View <span class="categories-list-item-badge">4</span></div></a><a href="/categories/Third-Libraries/"><div class="categories-list-item">Third Libraries <span class="categories-list-item-badge">11</span></div></a><a href="/categories/Kotlin/"><div class="categories-list-item">Kotlin <span class="categories-list-item-badge">6</span></div></a><a href="/categories/Flutter/"><div class="categories-list-item">Flutter <span class="categories-list-item-badge">6</span></div></a><a href="/categories/Java/"><div class="categories-list-item">Java <span class="categories-list-item-badge">2</span></div></a></div></div></article></div></aside><main class="main-column"><div class="image-wrapper"><img alt="FFmpeg编译so库文件 thumbnail" class="image lozad" src="/img/cover/cover-ffmpeg1.webp" data-src="</%= page.banner_img " srcset="data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPSc4MDAnIGhlaWdodD0nMjQwJz48cmVjdCB4PScwJyB5PScwJyB3aWR0aD0nODAwJyBoZWlnaHQ9JzI0MCcgZmlsbD0nI2ZhZmFmYScvPjx0ZXh0IHg9JzUwJScgeT0nNTAlJyBzdHlsZT0nZG9taW5hbnQtYmFzZWxpbmU6bWlkZGxlO3RleHQtYW5jaG9yOm1pZGRsZTtmb250LXNpemU6NTNweCcgZmlsbD0nI2I3YjdiNyc+5Zu+54mH5Yqg6L295LitPC90ZXh0Pjwvc3ZnPg=="></div><article class="card card-content article-content"><header><h1 class="post-title">FFmpeg编译so库文件</h1></header><div class="post-meta post-show-meta"><time datetime="2023-09-06T11:21:34.000Z"><i class="icon-calendar iconfont" style="margin-right:2px"></i> <span>2023-09-06</span> </time><span class="dot"></span> <a href="/categories/Third-Libraries/" class="post-meta-link">Third Libraries </a><span class="dot"></span> <span>约2.5k 字</span></div><div class="post-content" id="section"><p><code>FFmpeg</code>是一个音视频库，是使用<code>C语言</code>开发的，目前在各个行业都应用很广。在<code>Android</code>中，也通常都是使用其作为音视频播放和处理方案，当然为了更适配对应的平台，我们可能很少直接使用<code>FFmpeg</code>，而是使用其他的对<code>FFmpeg</code>进行二次封装的库，如<code>ijkPlayer</code>等，但了解<code>FFmpeg</code>会让我们在遇到难题时更易找到解决方案。</p><h3 id="FFmpeg的编译"><a href="#FFmpeg的编译" class="headerlink" title="FFmpeg的编译"></a>FFmpeg的编译</h3><p>如果要在<code>Android</code>中使用，我们通常会使用交叉编译的方式编出对应的so文件，然后在引入到<code>Android</code>中进行使用，这里最好使用在<code>Linux</code>环境中进行编译。</p><ol><li>创建一个编译目录：</li></ol><figure class="shell highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="shell hljs">mkdir buildffmpeg<br>cd buildffmpeg<br></code></pre></td></tr></table></figure><ol start="2"><li>下载<code>ndk</code>：</li></ol><figure class="shell highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="shell hljs"><span class="hljs-meta prompt_"># </span><span class="language-bash">下载ndk</span><br>sudo apt install curl<br>crul https://googledownloads.cn/android/repository/android-ndk-r27c-linux.zip --output android-ndk-r27c-linux.zip<br><span class="hljs-meta prompt_"># </span><span class="language-bash">解压</span><br>sudo apt install unzip<br>unzip android-ndk-r27c-linux.zip<br></code></pre></td></tr></table></figure><p>此时在目录中会有一个<code>android-ndk-r27</code>的目录，这个目录就是<code>ndk</code>的目录。如果不想使用命令的方式，直接在浏览器中访问官网更好，因为可能下载到最新的<code>ndk</code>版本，地址是<a href="https://developer.android.google.cn/ndk/downloads/index.html?hl=uk" rel="noopener" target="_blank">https://developer.android.google.cn/ndk/downloads/index.html?hl=uk</a></p><ol start="3"><li>下载<code>ffmpeg</code>源码：</li></ol><figure class="shell highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="shell hljs">curl https://ffmpeg.org/releases/ffmpeg-7.1.1.tar.gz --output ffmpeg-7.1.1.tar.gz<br>tar -zxvf ffmpeg-7.1.1.tar.gz<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">或者直接通过git下载也行</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">git <span class="hljs-built_in">clone</span> https://git.ffmpeg.org/ffmpeg.git ffmpeg</span><br></code></pre></td></tr></table></figure><p>此时目录中会有一个<code>ffmpeg-7.1.1</code>的目录，这个目录中存储的就是<code>ffmpeg</code>的源码。如果不想使用命令的方式，直接在浏览器中访问官网更好，因为可以下载到最新的版本或者你想要的版本。地址是：<a href="https://ffmpeg.org/download.html#releases" rel="noopener" target="_blank">https://ffmpeg.org/download.html#releases</a></p><ol start="4"><li>编译链接库</li></ol><p>在<code>FFmpeg</code>中有一个<code>configure</code>文件，该文件是一个脚本文件，用来控制如何进行编译的，如果是直接编译的话，直接执行<code>configure</code>文件即可，但我们需要在<code>Android</code>中使用，因此需要将<code>ndk</code>配置进去。</p><figure class="shell highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="shell hljs">cd ffmpeg-7.1.1<br>touch build.sh<br>chmod u+x build.sh<br></code></pre></td></tr></table></figure><p>我们进入到了<code>ffmpeg</code>目录，然后创建了一个<code>build.sh</code>文件，这个文件就是最终的编译脚本，我们会在其中调用<code>configure</code>文件从而达成编译的目的，文件内容如下：</p><figure class="shell highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="shell hljs"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">NDK根目录</span><br>NDK=../android-ndk-r27c<br><span class="hljs-meta prompt_"># </span><span class="language-bash">编译文件的输出目录前缀，输出文件会放在这个目录下</span><br>PREFIX=output<br><span class="hljs-meta prompt_"># </span><span class="language-bash">工具链目录，方便后面引用的</span><br>TOOLCHAIN=$NDK/toolchains/llvm/prebuilt/linux-x86_64/bin<br><span class="hljs-meta prompt_"># </span><span class="language-bash">系统目录，会从该目录中找到对应的头文件和so文件进行编译</span><br>SYSROOT=$NDK/toolchains/llvm/prebuilt/linux-x86_64/sysroot<br><span class="hljs-meta prompt_"># </span><span class="language-bash">交叉编译的前缀，所有的命令都会加上这个前缀</span><br>CROSS_PREFIX=$TOOLCHAIN/llvm-<br><span class="hljs-meta prompt_"># </span><span class="language-bash">Android版本，用于获取不同的cc命令</span><br>API=30<br><br>function build() &#123;<br>    ./configure \<br>	    --prefix=$PREFIX/$ABI \<br>	    --cross-prefix=$CROSS_PREFIX \<br>	    --target-os=android \<br>	    --arch=$ARCH \<br>	    --sysroot=$SYSROOT \<br>	    --cc=$&#123;C_PREFIX&#125;clang \<br>	    --cxx=$&#123;C_PREFIX&#125;clang++ \<br>	    --pkg-config=pkg-config \<br>	    --disable-static \<br>	    --enable-shared \<br>	    --disable-ffmpeg \<br>	    --disable-ffplay \<br>	    --disable-ffprobe <br><br>	make clean<br>	make -j16<br>	make install<br>&#125;<br><br>echo &quot;build armeabi-v7a...&quot;<br>ARCH=arm<br>ABI=armeabi-v7a<br>C_PREFIX=$TOOLCHAIN/armv7a-linux-androideabi$API-<br>build<br><br>echo &quot;build arm64-v8a&quot;<br>ARCH=aarch64<br>ABI=arm64-v8a<br>C_PREFIX=$TOOLCHAIN/aarch64-linux-android$API-<br>build<br><br>echo &quot;build x86_64&quot;<br>ARCH=x86_64<br>ABI=x86_64<br>C_PREFIX=$TOOLCHAIN/x86_64-linux-android$API-<br>build<br></code></pre></td></tr></table></figure><p>在然后就是进行构建了，这里编了三个不同架构的so库，一个是32位的<code>armv7a</code>，一个是64位的<code>arm64</code>的，还有一个模拟器的<code>x86_64</code>的，根据自己实际的项目进行选择，想要编译直接调用该脚本即可。</p><figure class="shell highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="shell hljs"><span class="hljs-meta prompt_"># </span><span class="language-bash">编译x86的so时需要安装nasm工具</span><br>sudo apt install nasm<br><span class="hljs-meta prompt_"># </span><span class="language-bash">构建</span><br>./build.sh<br><span class="hljs-meta prompt_"># </span><span class="language-bash">查看编译结果</span><br>cd output<br>ls<br></code></pre></td></tr></table></figure><p>在<code>ffmpeg-7.1.1/output</code>目录下，是我们两次的编译结果，我们需要的就是对应的<code>include</code>中的头文件，以及<code>lib</code>中的<code>so</code>库文件。</p><h3 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h3><p>前面的编译脚本<code>build.sh</code>，实际看下就知道它最终还是通过<code>configure</code>脚本来实现的，只是通过不同的参数进行控制的。接下来先看下前面的参数：</p><figure class="shell highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="shell hljs">./configure \<br>	--prefix=$PREFIX/$CPU \<br>	--cross-prefix=$CROSS_PREFIX \<br>	--target-os=android \<br>	--arch=$ARCH \<br>	--sysroot=$SYSROOT \<br>	--cc=$&#123;C_PREFIX&#125;clang \<br>	--cxx=$&#123;C_PREFIX&#125;clang++ \<br>	--pkg-config=pkg-config \<br></code></pre></td></tr></table></figure><ol><li><p><code>--prefix</code>，它代表着输出产物的前缀，该目录可以随意设置，这里因为我们编译了两份产物，因此在前缀并不是相同的，避免文件重复。</p></li><li><p><code>--cross-prefix</code>，它代表着交叉编译的前缀。编译的过程会涉及到很多的命令，如<code>nm</code>、<code>ar</code>等，正常编译会直接找到系统命令去进行编译，但我们编的不是当前平台，而是<code>android</code>平台，因此不能直接找系统中的这些命令，而是从<code>ndk</code>中查找。<code>android-ndk-r27c/toolchains/llvm/prebuilt/linux-x86_64/bin</code>这个目录中就是我们需要的命令，可以看到除了<code>clang</code>和<code>clang++</code>与平台版本有差异外，其他的都没有差异，而是都加了<code>llvm-</code>的前缀，因此这里的参数我们也需要设置成<code>llvm-</code>。</p></li><li><p><code>--target-os</code>，目标平台直接填<code>android</code>就行。</p></li><li><p><code>--arch</code> ，目标平台的架构，常见的<code>arm</code>是32位的架构，最通用的架构，老机型用的多；<code>aarch64</code>是64位的架构，目前的主流架构；<code>x86_64</code>模拟器上使用。</p></li><li><p><code>sysroot</code>系统查找目录，包含了头文件以及对应的链接库文件，对应的是<code>android-ndk-r27c/toolchains/llvm/prebuilt/linux-x86_64/sysroot</code>目录</p></li><li><p><code>--cc</code>和<code>--cxx</code>，编译c和c++的命令，对应着<code>llvm</code>中的<code>clang</code>和<code>clang++</code>。注意这里是有区分的，需要区分不同的架构和安卓版本号，如果我们不指定这两个参数的话，它会使用前面设置的<code>prefix</code>来查找命令，如它会去找<code>llvm-clang</code>命令，结果当然是找不到的。因此这里我们给他手动指定前缀，具体前缀可以在<code>android-ndk-r27c/toolchains/llvm/prebuilt/linux-x86_64/bin</code>目录中找到clang命令，然后查看规律在设置就行了，如<code>armv7a</code>，安卓30对应的是<code>armv7a-linux-androideabi30-clang</code>命令，<code>armv8a</code>安卓30对应的是<code>aarch64-linux-android30-clang</code>命令。</p></li><li><p><code>--pkg-config</code>，这个是属于系统命令，需要确保系统中有安装<code>pkg-config</code>，可以通过<code>sudo apt install pkg-config</code>进行安装，为什么要明确指定呢，因为前面我们有设置<code>--cross-prefix</code>，该属性应用后会导致命令变成<code>llvm-pkg-config</code>，导致找不到对应的命令，因此我们才需要重新指定下。</p></li></ol><p>前面的参数都是交叉编译所涉及的一些参数，不涉及到具体的功能相关，而后续的参数则是与<code>FFmpeg</code>相关的：</p><figure class="shell highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="shell hljs">--disable-static \<br>--enable-shared \<br>--disable-ffmpeg \<br>--disable-ffplay \<br>--disable-ffprobe \<br></code></pre></td></tr></table></figure><ol><li><code>--disable-static</code>：关闭静态链接库，通常生成的是<code>.a</code>文件，在编译时会直接编在文件中</li><li><code>--enable-shared</code>：打开共享库，通常生成的是<code>.so</code>文件，也是我们的目标文件</li><li><code>ffmpeg</code>、<code>ffplay</code>、<code>ffrpobe</code>是<code>FFmpeg</code>的命令行工具，因为我们不需要它们，因此直接<code>disable</code>即可</li></ol><p>更多的参数涉及到了封装、编码等相关功能，实际上基本所有的功能都是通过<code>disable</code>和<code>enable</code>命令来打开和关闭的，因此需要我们自己衡量并进行裁剪。因为<code>FFmpeg</code>的功能是非常多的，如果我们不做任何裁剪的话，生成的<code>so</code>也会很大，如果只是作为学习的话，就不用去裁剪了，完整版的才是最好的。具体的功能配置在<code>ffmpeg-7.1.1/configure</code>文件中都有说明。</p><h3 id="引入到安卓中"><a href="#引入到安卓中" class="headerlink" title="引入到安卓中"></a>引入到安卓中</h3><p>如果先麻烦可以直接新建一个<code>native C++</code>项目，如果是已有项目则可以新建一个<code>Module</code>，然后将其配置成支持<code>C++</code>，如果不会配置的话，直接创建一个新的<code>native C++</code>项目，然后抄一下<code>gradle</code>的写法即可。</p><p>然后就是引入我们编译好的<code>so</code>文件，首先修改<code>gradle</code>：</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">android &#123;<br>    ...<br>    defaultConfig &#123;<br>        ...<br>        ndk &#123;<br>            abiFilters += listOf(<span class="hljs-string">&quot;arm64-v8a&quot;</span>, <span class="hljs-string">&quot;armeabi-v7a&quot;</span>, <span class="hljs-string">&quot;x86_64&quot;</span>)<br>            <span class="hljs-comment">// 如果是groovy的话，改成如下形式</span><br>            <span class="hljs-comment">// abiFilters &#x27;arm64-v8a&#x27;, &#x27;armeabi-v7a&#x27;, &#x27;x86_64&#x27;</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>主要就是修改<code>abiFilters</code>，因为我们只编译了这两种<code>so</code>。接着就是将<code>so</code>放在项目中，在该<code>module</code>的<code>src/main</code>目录下新建一个目录，注意如果<code>AGP</code>版本低于<code>4.0</code>的话，新建的目录名称需要是<code>jniLibs</code>，高于<code>4.0</code>就随意命名了，这里我命名的是<code>libs</code>目录。然后在该目录下新建两个目录分别为<code>arm64-v8a</code>和<code>armeabi-v7a</code>，然后将前面生成的<code>so</code>分别放在对应的目录中，大概的层级如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">module<br>  |-src<br>    |-main<br>      |-libs<br>        |-arm64-v8a<br>          |--libavformat.so<br>          |--....<br>        |-armeabi-v7a<br>          |--libavformat.so<br>          |--....<br>        |-x86_64<br>          |--libavformat.so<br>          |--....<br></code></pre></td></tr></table></figure><p>接下来修改项目中的<code>CMakeLists.txt</code>，将我们的so和头文件包含进去。首先是将<code>FFmpeg</code>的头文件放在<code>cpp</code>的目录中，这里为了区分新建了一个文件夹来放头文件，目录如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">module<br>  |-src<br>    |-main<br>      |-libs<br>      |-cpp<br>        |-libraries<br>          |-ffmpeg<br>            |-include<br>          |-CMakeLists.txt<br>          |-native-lib.cpp<br></code></pre></td></tr></table></figure><p>然后修改<code>CMakeLists.txt</code>，将头文件包含进来，然后在引入<code>so</code>文件：</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-keyword">cmake_minimum_required</span>(VERSION <span class="hljs-number">3.22</span>.<span class="hljs-number">1</span>)<br><span class="hljs-keyword">project</span>(<span class="hljs-string">&quot;ffmpegdemo&quot;</span>)<br><br><span class="hljs-comment"># 引入ffmpeg的头文件</span><br><span class="hljs-keyword">include_directories</span>(<span class="hljs-string">&quot;libraries/ffmpeg/include&quot;</span>)<br><br><span class="hljs-comment"># 引入ffmpeg的库文件，根据实际引入，这里选择全引入</span><br><span class="hljs-keyword">set</span>(FFmpegs avcodec avdevice avfilter avformat avutil swresample swscale)<br><span class="hljs-keyword">foreach</span> (item IN LISTS FFmpegs)<br>    <span class="hljs-keyword">add_library</span>(<span class="hljs-variable">$&#123;item&#125;</span> SHARED IMPORTED)<br>    <span class="hljs-keyword">set_target_properties</span>(<br>            <span class="hljs-variable">$&#123;item&#125;</span><br>            PROPERTIES IMPORTED_LOCATION<br>            <span class="hljs-variable">$&#123;CMAKE_SOURCE_DIR&#125;</span>/../libs/<span class="hljs-variable">$&#123;CMAKE_ANDROID_ARCH_ABI&#125;</span>/lib<span class="hljs-variable">$&#123;item&#125;</span>.so<br>    )<br><span class="hljs-keyword">endforeach</span> ()<br><br><span class="hljs-comment"># 这是新建项目时自己创建的，暂时不用修改</span><br><span class="hljs-keyword">add_library</span>(<span class="hljs-variable">$&#123;CMAKE_PROJECT_NAME&#125;</span> SHARED<br>        native-lib.cpp)<br><br><span class="hljs-keyword">target_link_libraries</span>(<span class="hljs-variable">$&#123;CMAKE_PROJECT_NAME&#125;</span><br>        <span class="hljs-variable">$&#123;FFmpegs&#125;</span> <span class="hljs-comment"># 将ffmpeg的库都引入</span><br>        android<br>        log)<br></code></pre></td></tr></table></figure><p>到这里就已经引入完成了，我们直接编译一个<code>apk</code>，然后将其拖入到<code>as</code>中，就能看到<code>apk</code>中已经包含了我们引入的<code>FFmpeg</code>的<code>so</code>。</p><p>我们可以直接修改<code>native-lib.cpp</code>中返回字串的函数，然后调用<code>FFmpeg</code>的方法查看我们编译<code>FFmpeg</code>时的配置信息：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;jni.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span><br><br><span class="hljs-keyword">extern</span> <span class="hljs-string">&quot;C&quot;</span> &#123;<br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;libavutil/avutil.h&quot;</span></span><br>&#125;<br><br><br><span class="hljs-keyword">extern</span> <span class="hljs-string">&quot;C&quot;</span> <span class="hljs-function">JNIEXPORT jstring JNICALL</span><br><span class="hljs-function"><span class="hljs-title">Java_com_example_ffmpegdemo_MainActivity_stringFromJNI</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">        JNIEnv* env,</span></span><br><span class="hljs-params"><span class="hljs-function">        jobject <span class="hljs-comment">/* this */</span>)</span> </span>&#123;<br>	<span class="hljs-comment">// 能成功调用，说明引入成功了</span><br>    <span class="hljs-type">const</span> <span class="hljs-type">char</span>* str  = <span class="hljs-built_in">avutil_configuration</span>();<br>    <span class="hljs-keyword">return</span> env-&gt;<span class="hljs-built_in">NewStringUTF</span>(str);<br>&#125;<br></code></pre></td></tr></table></figure><p>直接运行就能看到输出的信息确实是我们编译时的<code>configure</code>信息。</p></div></article><div><div class="copyright note-warning post-note"><p></p><div class="post-data">本文发布于<span id="post-time"></span>天前，最后更新于<span id="update-time"></span>天前，内容可能会与最新版本有所差异。</div><script>document.addEventListener("DOMContentLoaded",function(){var e=new Date,t=new Date("Wed Sep 06 2023 19:21:34 GMT+0800");let n="Wed Sep 06 2023 19:21:34 GMT+0800";n="2025-03-25 20:53:03 +0800";var d=new Date(n),t=Math.floor((e-t)/864e5),e=Math.floor((e-d)/864e5);document.getElementById("post-time").innerText=t,document.getElementById("update-time").innerText=e})</script><p></p></div></div><div class="post-footer"><a href="/categories/Third-Libraries/" class="post-footer-category">#&nbsp;Third Libraries</a> <a href="/tags/FFmpeg/" class="post-footer-tag">#&nbsp;FFmpeg</a></div><div class="nav"><div class="nav-item-prev"><a href="/2023/10/05/ffmpeg2/" class="nav-link"><div><div class="nav-label">上一篇</div><div class="nav-title">FFmpeg解封装与重封装</div></div></a></div><div class="nav-item-next"><a href="/2023/08/27/overscroll/" class="nav-link"><div><div class="nav-label">下一篇</div><div class="nav-title">View自定义回弹动效</div></div></a></div></div><div class="card card-content toc-card" id="mobiletoc"><div class="toc-header">目录</div><ol class="toc"><li class="toc-item toc-level-3"><a href="#FFmpeg%E7%9A%84%E7%BC%96%E8%AF%91" class="toc-link"><span class="toc-text">FFmpeg的编译</span></a></li><li class="toc-item toc-level-3"><a href="#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E" class="toc-link"><span class="toc-text">参数说明</span></a></li><li class="toc-item toc-level-3"><a href="#%E5%BC%95%E5%85%A5%E5%88%B0%E5%AE%89%E5%8D%93%E4%B8%AD" class="toc-link"><span class="toc-text">引入到安卓中</span></a></li></ol></div></main><aside class="right-column"><div class="sticky-widescreen"><article class="card card-content"><div class="recent-posts-card"><div class="recent-posts-header">相关文章</div><div class="recent-posts-list"><div class="recent-posts-item"><div class="recent-posts-item-title">2023-12-20</div><a href="/2023/12/20/ffmpeg4/"><div class="recent-posts-item-content">FFmpeg解码视频YUV</div></a></div><div class="recent-posts-item recent-posts-item-other"><div class="recent-posts-item-title">2023-11-13</div><a href="/2023/11/13/ffmpeg3/"><div class="recent-posts-item-content">FFmpeg解码音频PCM</div></a></div><div class="recent-posts-item recent-posts-item-other"><div class="recent-posts-item-title">2023-10-05</div><a href="/2023/10/05/ffmpeg2/"><div class="recent-posts-item-content">FFmpeg解封装与重封装</div></a></div><div class="recent-posts-item recent-posts-item-other"><div class="recent-posts-item-title">2024-01-02</div><a href="/2024/01/02/navigation/"><div class="recent-posts-item-content">在Compose中使用Navigation</div></a></div><div class="recent-posts-item recent-posts-item-other"><div class="recent-posts-item-title">2021-10-12</div><a href="/2021/10/12/bsdiff-translation/"><div class="recent-posts-item-content">【翻译】Naive Differences of Executable Code</div></a></div></div></div></article><article class="card card-content"><div class="recent-posts-card"><div class="recent-posts-header">最近文章</div><div class="recent-posts-list"><div class="recent-posts-item"><div class="recent-posts-item-title">2024-09-10</div><a href="/2024/09/10/flutter-state/"><div class="recent-posts-item-content">Flutter状态管理</div></a></div><div class="recent-posts-item recent-posts-item-other"><div class="recent-posts-item-title">2024-08-16</div><a href="/2024/08/16/flutter-canvas/"><div class="recent-posts-item-content">Flutter自定义绘制CustomPaint</div></a></div><div class="recent-posts-item recent-posts-item-other"><div class="recent-posts-item-title">2024-07-23</div><a href="/2024/07/23/flutter-getx/"><div class="recent-posts-item-content">Flutter强大脚手架-GetX</div></a></div><div class="recent-posts-item recent-posts-item-other"><div class="recent-posts-item-title">2024-06-16</div><a href="/2024/06/16/flutter-navigator/"><div class="recent-posts-item-content">Flutter界面跳转-Navigator</div></a></div></div></div></article></div></aside></div></div></div></div><script>let initCount=0;function initClipboard(){++initCount<2||new ClipboardJS(".btn-copy").on("success",function(n){n.clearSelection(),n.trigger.innerHTML=icon_yes,setTimeout(()=>{n.trigger.innerHTML=icon_copy},1e3)})}var addLazyload=function(){lozad(".lozad",{load:function(n){n.srcset=n.getAttribute("data-src")},loaded:function(n){n.classList.add("loaded")}}).observe()}</script><script>loadScript("/js/lib/lozad.min.js",addLazyload)</script><script>loadScript("/js/lib/toc-highlight-scroll.min.js",()=>{tocSetup(),addCopyButton(),initClipboard()})</script><script>loadScript("/js/lib/clipboard.min.js",()=>initClipboard())</script></body></html>