<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta content="width=device-width,initial-scale=1,minimum-scale=1" name="viewport"><meta content="ie=edge" http-equiv="X-UA-Compatible"><meta content="#fff" name="theme-color" id="theme-color"><meta content="Hexo" name="description"><link href="/img/website.svg" rel="icon"><title>协程数据流Flow</title><link href="/css/main.css" rel="preload" as="style"><link href="/css/main.css" rel="stylesheet"><link href="/css/libs/atom-one-light.min.css" rel="preload" as="style"><link href="/css/libs/atom-one-light.min.css" rel="stylesheet"><script>function loadScript(e,t){var n=document.createElement("script");n.src=e,t&&(n.onload=t),n.async=!0,document.body.appendChild(n)}function loadCSS(e){var t=document.createElement("link");t.ref="stylesheet",t.href=e,document.head.appendChild(t)}function changeCSS(e,t,n){var t=document.querySelector(t),c=document.createElement("link");c.setAttribute("rel","stylesheet"),c.setAttribute("href",e),c.dataset.prism=n,document.head.replaceChild(c,t)}</script><link href="/js/lib/lozad.min.js" rel="preload" as="script"><meta content="Hexo 8.1.0" name="generator"></head><body><div class="wrapper"><nav class="navbar"><div class="nav-container"><div class="navbar-menu"><a href="/" class="navbar-menu-item">首页 </a><a href="/archives" class="navbar-menu-item">归档 </a><a href="/tags" class="navbar-menu-item">标签 </a><a href="/categories" class="navbar-menu-item">分类</a></div></div></nav><div class="section-wrap"><div class="container"><div class="columns"><aside class="left-column"><div class="card card-author"><img class="author-img" src="/img/website.svg" alt="author avatar" height="88" width="88"><p class="author-name">pppeng</p><p class="author-description">一日不书 百事荒芜</p><div class="author-message"><a href="/archives" class="author-posts-count"><span>40</span> <span>文章</span> </a><a href="/categories" class="author-categories-count"><span>6</span> <span>分类</span> </a><a href="/tags" class="author-tags-count"><span>19</span> <span>标签</span> </a><a class="author-word-count"><span>15.54</span> <span>万字</span></a></div></div><div class="sticky-tablet"><article class="display-when-two-columns spacer"><div class="card card-content toc-card"><div class="toc-header">目录</div><ol class="toc"><li class="toc-item toc-level-2"><a href="#%E7%94%9F%E6%88%90%E6%95%B0%E6%8D%AE%E6%B5%81" class="toc-link"><span class="toc-text">生成数据流</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a href="#flow" class="toc-link"><span class="toc-text">flow</span></a></li><li class="toc-item toc-level-3"><a href="#asFlow" class="toc-link"><span class="toc-text">asFlow</span></a></li><li class="toc-item toc-level-3"><a href="#flowOf" class="toc-link"><span class="toc-text">flowOf</span></a></li></ol></li><li class="toc-item toc-level-2"><a href="#%E6%94%B6%E9%9B%86%E6%95%B0%E6%8D%AE%E6%B5%81" class="toc-link"><span class="toc-text">收集数据流</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a href="#collect%E3%80%81collectIndexed" class="toc-link"><span class="toc-text">collect、collectIndexed</span></a></li><li class="toc-item toc-level-3"><a href="#collectLatest" class="toc-link"><span class="toc-text">collectLatest</span></a></li><li class="toc-item toc-level-3"><a href="#reduce" class="toc-link"><span class="toc-text">reduce</span></a></li><li class="toc-item toc-level-3"><a href="#fold" class="toc-link"><span class="toc-text">fold</span></a></li><li class="toc-item toc-level-3"><a href="#single%E3%80%81singleOrNull" class="toc-link"><span class="toc-text">single、singleOrNull</span></a></li><li class="toc-item toc-level-3"><a href="#first%E3%80%81firstOrNull%E3%80%81last%E3%80%81lastOrNull" class="toc-link"><span class="toc-text">first、firstOrNull、last、lastOrNull</span></a></li></ol></li><li class="toc-item toc-level-2"><a href="#%E8%BD%AC%E6%8D%A2%E6%95%B0%E6%8D%AE%E6%B5%81" class="toc-link"><span class="toc-text">转换数据流</span></a></li></ol></div></article><article class="card card-content categories-widget"><div class="categories-card"><div class="categories-header">分类</div><div class="categories-list"><a href="/categories/Android-Framework/"><div class="categories-list-item">Android Framework <span class="categories-list-item-badge">12</span></div></a><a href="/categories/Android-View/"><div class="categories-list-item">Android View <span class="categories-list-item-badge">4</span></div></a><a href="/categories/Third-Libraries/"><div class="categories-list-item">Third Libraries <span class="categories-list-item-badge">11</span></div></a><a href="/categories/Kotlin/"><div class="categories-list-item">Kotlin <span class="categories-list-item-badge">6</span></div></a><a href="/categories/Flutter/"><div class="categories-list-item">Flutter <span class="categories-list-item-badge">5</span></div></a><a href="/categories/Java/"><div class="categories-list-item">Java <span class="categories-list-item-badge">2</span></div></a></div></div></article></div></aside><main class="main-column"><div class="image-wrapper"><img class="lozad image" src="/img/cover/cover-flow.webp" data-src="</%= page.banner_img " srcset="data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPSc4MDAnIGhlaWdodD0nMjQwJz48cmVjdCB4PScwJyB5PScwJyB3aWR0aD0nODAwJyBoZWlnaHQ9JzI0MCcgZmlsbD0nI2ZhZmFmYScvPjx0ZXh0IHg9JzUwJScgeT0nNTAlJyBzdHlsZT0nZG9taW5hbnQtYmFzZWxpbmU6bWlkZGxlO3RleHQtYW5jaG9yOm1pZGRsZTtmb250LXNpemU6NTNweCcgZmlsbD0nI2I3YjdiNyc+5Zu+54mH5Yqg6L295LitPC90ZXh0Pjwvc3ZnPg==" alt="协程数据流Flow thumbnail"></div><article class="card card-content article-content"><header><h1 class="post-title">协程数据流Flow</h1></header><div class="post-meta post-show-meta"><time datetime="2023-05-22T11:21:18.000Z"><i class="icon-calendar iconfont" style="margin-right:2px"></i> <span>2023-05-22</span> </time><span class="dot"></span> <a href="/categories/Kotlin/" class="post-meta-link">Kotlin </a><span class="dot"></span> <span>约1.4k 字</span></div><div class="post-content" id="section"><p><code>Flow</code>字如其名，是一个数据流操作，他是基于<code>Kotlin</code>协程实现的异步数据流，方便我们对数据进行处理或者进行数据交换。简单点来说，就是<code>flow</code>提供了一组操作方法，通过链式调用来依次对数据进行操作修改，也可以在别的地方对<code>flow</code>设置观察者(<code>collect</code>)，当数据流处理完毕后，数据会被发送给观察者进行消费。</p><p><img class="lozad post-image" src="/img/flow.webp" data-src="/img/flow.webp" srcset="data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPSc4MDAnIGhlaWdodD0nMjQwJz48cmVjdCB4PScwJyB5PScwJyB3aWR0aD0nODAwJyBoZWlnaHQ9JzI0MCcgZmlsbD0nI2ZhZmFmYScvPjx0ZXh0IHg9JzUwJScgeT0nNTAlJyBzdHlsZT0nZG9taW5hbnQtYmFzZWxpbmU6bWlkZGxlO3RleHQtYW5jaG9yOm1pZGRsZTtmb250LXNpemU6NTNweCcgZmlsbD0nI2I3YjdiNyc+5Zu+54mH5Yqg6L295LitPC90ZXh0Pjwvc3ZnPg=="></p><h2 id="生成数据流"><a href="#生成数据流" class="headerlink" title="生成数据流"></a>生成数据流</h2><p>若要操作数据流，最先做的应该是生成一个数据流。<code>Flow&lt;out T&gt;</code>是一个接口，它的泛型类就是流中的数据，Flow给我们提供了很多的创建流的方式。</p><p>生成数据流比较简单，实际场景我们一般将网络请求的数据转换成<code>flow</code>进行处理，或者是获取到一组的数据转成<code>flow</code>进行处理，又或者是将<code>flow</code>作为观察者模式，在<code>ViewModel</code>中发射数据，在<code>View</code>层中观察数据。</p><p><img class="lozad post-image" src="/img/flow-create.webp" data-src="/img/flow-create.webp" srcset="data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPSc4MDAnIGhlaWdodD0nMjQwJz48cmVjdCB4PScwJyB5PScwJyB3aWR0aD0nODAwJyBoZWlnaHQ9JzI0MCcgZmlsbD0nI2ZhZmFmYScvPjx0ZXh0IHg9JzUwJScgeT0nNTAlJyBzdHlsZT0nZG9taW5hbnQtYmFzZWxpbmU6bWlkZGxlO3RleHQtYW5jaG9yOm1pZGRsZTtmb250LXNpemU6NTNweCcgZmlsbD0nI2I3YjdiNyc+5Zu+54mH5Yqg6L295LitPC90ZXh0Pjwvc3ZnPg=="></p><h3 id="flow"><a href="#flow" class="headerlink" title="flow"></a>flow</h3><figure class="kotlin highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="kotlin hljs"><span class="hljs-keyword">val</span> flow = flow &#123;<br>    <span class="hljs-comment">// 可以通过emit方法发射数据，同时作用域内也可以使用协程</span><br>    emit(<span class="hljs-number">1</span>)<br>    delay(<span class="hljs-number">10</span>)<br>    emit(<span class="hljs-number">2</span>)<br>&#125;<br><br>lifecycleScope.lunch &#123;<br>    <span class="hljs-comment">// 获取flow中的数据流，必须在协程作用域内收集</span><br>    flow.collect &#123;<br>        Log.d(TAG, <span class="hljs-string">&quot;collect flow = <span class="hljs-variable">$it</span>&quot;</span>)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>最常见的就是通过<code>flow</code>方法去创建一个<code>flow</code>，其参数闭包是一个<code>FlowCollector</code>的拓展函数，即我们可以在闭包内通过<code>emit</code>方法去发射数据。<code>flow</code>对于协程的支持程度非常高，毕竟他就是基于协程而创建的数据流，不仅在创建协程的闭包内允许使用协程，在收集数据流的时候也要求必须在协程作用域内收集。</p><h3 id="asFlow"><a href="#asFlow" class="headerlink" title="asFlow"></a>asFlow</h3><p><code>asFlow</code>是一个拓展方法，也是用于生成<code>flow</code>的，它的拓展范围是非常大的，从高阶函数，到数组集合，几乎所有能产生数据的对象都可以通过<code>asFlow</code>将其转变成<code>flow</code>。</p><figure class="kotlin highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="kotlin hljs"><span class="hljs-keyword">val</span> flow = &#123;<br>    <span class="hljs-comment">// 高阶函数，返回值为1，通过asFlow转换成flow</span><br>    <span class="hljs-number">1</span><br>&#125;.asFlow()<br><br><span class="hljs-keyword">val</span> flow1 = (<span class="hljs-number">1.</span><span class="hljs-number">.10</span>).asFlow()<br><span class="hljs-keyword">val</span> flow2 = listOf(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>).asFlow()<br><span class="hljs-keyword">val</span> flow3 = arrayOf(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>).asFlow()<br></code></pre></td></tr></table></figure><h3 id="flowOf"><a href="#flowOf" class="headerlink" title="flowOf"></a>flowOf</h3><p><code>flowOf</code>也是将数据转换成<code>flow</code>的，它通常是将一个或多个数据转成<code>flow</code>，而<code>asFlow</code>则是将一个集合中的多个数据转成<code>flow</code>。</p><figure class="kotlin highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="kotlin hljs"><span class="hljs-keyword">val</span> flow = flowOf(<span class="hljs-number">1</span>)<br><br><span class="hljs-keyword">val</span> flow1 = flowOf(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>)<br><br><span class="hljs-comment">// 创建一个空的flow</span><br><span class="hljs-keyword">val</span> flow2 = emptyFlow&lt;<span class="hljs-built_in">Int</span>&gt;()<br></code></pre></td></tr></table></figure><h2 id="收集数据流"><a href="#收集数据流" class="headerlink" title="收集数据流"></a>收集数据流</h2><p>当我们拿到一个flow后，我们需要从flow中获取数据，而flow也给我们提供了很多的操作符进行快速获取。需要注意的是，数据的获取方法都必须在协程作用域内执行，当我们的协程作用域被取消后，flow也会被直接取消掉。</p><p><img class="lozad post-image" src="/img/flow-terminate.webp" data-src="/img/flow-terminate.webp" srcset="data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPSc4MDAnIGhlaWdodD0nMjQwJz48cmVjdCB4PScwJyB5PScwJyB3aWR0aD0nODAwJyBoZWlnaHQ9JzI0MCcgZmlsbD0nI2ZhZmFmYScvPjx0ZXh0IHg9JzUwJScgeT0nNTAlJyBzdHlsZT0nZG9taW5hbnQtYmFzZWxpbmU6bWlkZGxlO3RleHQtYW5jaG9yOm1pZGRsZTtmb250LXNpemU6NTNweCcgZmlsbD0nI2I3YjdiNyc+5Zu+54mH5Yqg6L295LitPC90ZXh0Pjwvc3ZnPg=="></p><h3 id="collect、collectIndexed"><a href="#collect、collectIndexed" class="headerlink" title="collect、collectIndexed"></a>collect、collectIndexed</h3><p>最基础的就是<code>collect</code>操作符，通过该方法，我们可以获取到flow中的所有数据。</p><figure class="kotlin highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="kotlin hljs"><span class="hljs-keyword">val</span> flow = flowOf(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>)<br>lifecycleScope.launch &#123;<br>    flow.collect &#123;<br>        Log.d(TAG, <span class="hljs-string">&quot;collect = <span class="hljs-variable">$it</span>&quot;</span>)<br>    &#125;<br>    <span class="hljs-comment">// flow.collectIndexed &#123; index, value -&gt;</span><br>    <span class="hljs-comment">//    Log.d(TAG, &quot;collect = $value, index = $index&quot;)</span><br>    <span class="hljs-comment">// &#125;</span><br>&#125;<br><br><span class="hljs-comment">// 输出如下</span><br>collect = <span class="hljs-number">1</span><br>collect = <span class="hljs-number">1</span><br>collect = <span class="hljs-number">2</span><br>collect = <span class="hljs-number">2</span><br>collect = <span class="hljs-number">3</span><br>collect = <span class="hljs-number">4</span><br></code></pre></td></tr></table></figure><h3 id="collectLatest"><a href="#collectLatest" class="headerlink" title="collectLatest"></a>collectLatest</h3><p>获取最新的数据，当连续发送多个数据时，如果<code>collectLatest</code>的闭包内对上一个数据的操作还未处理完，则会直接取消闭包内的方法执行，然后重新发送下一个数据。</p><figure class="kotlin highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="kotlin hljs"><span class="hljs-keyword">val</span> flow = flowOf(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>)<br>lifecycleScope.launch &#123;<br>     flow.collectLatest &#123;<br>        println(<span class="hljs-string">&quot;pre collect = <span class="hljs-variable">$it</span>&quot;</span>)<br>        delay(<span class="hljs-number">10</span>)<br>        println(<span class="hljs-string">&quot;collect = <span class="hljs-variable">$it</span>&quot;</span>)<br>    &#125;<br>&#125;<br><span class="hljs-comment">// 输出如下：</span><br>pre collect = <span class="hljs-number">1</span><br>pre collect = <span class="hljs-number">1</span><br>pre collect = <span class="hljs-number">2</span><br>pre collect = <span class="hljs-number">2</span><br>pre collect = <span class="hljs-number">3</span><br>pre collect = <span class="hljs-number">4</span><br>collect = <span class="hljs-number">4</span><br></code></pre></td></tr></table></figure><p>可以看到，创建的<code>flow</code>会连续发射多个数据，然后每个数据会处理10ms然后输出，但是通过<code>collectLatest</code>操作符去获取数据时，每次的数据处理都会被取消掉，只有最后一个数据才会被完整的处理完。我们可以利用这种操作符的特性，在实际的开发中可以用作防抖。</p><h3 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a>reduce</h3><p><code>reduce</code>操作符用于将flow中的数据进行合并，最终返回一个结果值。</p><figure class="kotlin highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="kotlin hljs"><span class="hljs-keyword">val</span> flow = flowOf(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>)<br>lifecycleScope.launch &#123;<br>    <span class="hljs-keyword">val</span> result = flow.reduce &#123; accumulator, value -&gt;<br>        Log.d(TAG, <span class="hljs-string">&quot;accumulator = <span class="hljs-variable">$accumulator</span>, value = <span class="hljs-variable">$value</span>&quot;</span>)<br>        value + accumulator<br>    &#125;<br>    Log.d(TAG, <span class="hljs-string">&quot;result = <span class="hljs-variable">$result</span>&quot;</span>)<br>&#125;<br><span class="hljs-comment">// 输出如下</span><br>accumulator = <span class="hljs-number">1</span>, value = <span class="hljs-number">2</span><br>accumulator = <span class="hljs-number">3</span>, value = <span class="hljs-number">3</span><br>accumulator = <span class="hljs-number">6</span>, value = <span class="hljs-number">4</span><br>accumulator = <span class="hljs-number">10</span>, value = <span class="hljs-number">5</span><br>accumulator = <span class="hljs-number">15</span>, value = <span class="hljs-number">6</span><br>result = <span class="hljs-number">21</span><br></code></pre></td></tr></table></figure><h3 id="fold"><a href="#fold" class="headerlink" title="fold"></a>fold</h3><p><code>fold</code>操作符和<code>reduce</code>都是用于将flow中的数据进行合并的，不同的是<code>reduce</code>从名字看是将结果进行减少的，它实际操作时是将flow的每两个数据合并成一个数据，即初始值是flow的第一个值，同时合并后的值必须是flow的数据类型的子类或本身。</p><p>而<code>fold</code>并没有限制合并后的数据类型，同时fold也会提供一个初始值用于进行合并操作。</p><figure class="kotlin highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="kotlin hljs"><span class="hljs-keyword">val</span> flow = flowOf(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>)<br>lifecycleScope.launch &#123;<br>    <span class="hljs-keyword">val</span> result = flow.map(<span class="hljs-string">&quot;0&quot;</span>) &#123; accumulator, value -&gt;<br>        Log.d(TAG, <span class="hljs-string">&quot;accumulator = <span class="hljs-variable">$accumulator</span>, value = <span class="hljs-variable">$value</span>&quot;</span>)<br>        value + accumulator<br>    &#125;<br>    Log.d(TAG, <span class="hljs-string">&quot;result = <span class="hljs-variable">$result</span>&quot;</span>)<br>&#125;<br><span class="hljs-comment">// 输出如下</span><br>accumulator = <span class="hljs-number">0</span>, value = <span class="hljs-number">1</span><br>accumulator = <span class="hljs-number">01</span>, value = <span class="hljs-number">2</span><br>accumulator = <span class="hljs-number">012</span>, value = <span class="hljs-number">3</span><br>accumulator = <span class="hljs-number">0123</span>, value = <span class="hljs-number">4</span><br>accumulator = <span class="hljs-number">01234</span>, value = <span class="hljs-number">5</span><br>accumulator = <span class="hljs-number">012345</span>, value = <span class="hljs-number">6</span><br>result = <span class="hljs-number">0123456</span><br></code></pre></td></tr></table></figure><h3 id="single、singleOrNull"><a href="#single、singleOrNull" class="headerlink" title="single、singleOrNull"></a>single、singleOrNull</h3><p>使用<code>single</code>操作符要求flow有且只能有一个数据，如果有多个数据的话会直接抛出异常，如果没有数据的话也会抛出异常，因此没数据时需要使用<code>singleOrNull</code>。</p><h3 id="first、firstOrNull、last、lastOrNull"><a href="#first、firstOrNull、last、lastOrNull" class="headerlink" title="first、firstOrNull、last、lastOrNull"></a>first、firstOrNull、last、lastOrNull</h3><p><code>first</code>返回flow中数据的第一个，如果没有数据的话会报异常，因此无数据时需要使用<code>firstOrNull</code>。<code>last</code>返回flow中的最后一个数据，如果没有数据的话会抛出异常，因此无数据时需要使用<code>lastOrNull</code>。</p><h2 id="转换数据流"><a href="#转换数据流" class="headerlink" title="转换数据流"></a>转换数据流</h2><p><img class="lozad post-image" src="/img/flow-map.webp" data-src="/img/flow-map.webp" srcset="data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPSc4MDAnIGhlaWdodD0nMjQwJz48cmVjdCB4PScwJyB5PScwJyB3aWR0aD0nODAwJyBoZWlnaHQ9JzI0MCcgZmlsbD0nI2ZhZmFmYScvPjx0ZXh0IHg9JzUwJScgeT0nNTAlJyBzdHlsZT0nZG9taW5hbnQtYmFzZWxpbmU6bWlkZGxlO3RleHQtYW5jaG9yOm1pZGRsZTtmb250LXNpemU6NTNweCcgZmlsbD0nI2I3YjdiNyc+5Zu+54mH5Yqg6L295LitPC90ZXh0Pjwvc3ZnPg=="></p></div></article><div><div class="copyright note-warning post-note"><p></p><div class="post-data">本文发布于<span id="post-time"></span>天前，最后更新于<span id="update-time"></span>天前，内容可能会与最新版本有所差异。</div><script>document.addEventListener("DOMContentLoaded",function(){var e=new Date,t=new Date("Mon May 22 2023 19:21:18 GMT+0800");let n="Mon May 22 2023 19:21:18 GMT+0800";n="2024-09-25 21:51:59 +0800";var o=new Date(n),t=Math.floor((e-t)/864e5),e=Math.floor((e-o)/864e5);document.getElementById("post-time").innerText=t,document.getElementById("update-time").innerText=e})</script><p></p></div></div><div class="post-footer"><a href="/categories/Kotlin/" class="post-footer-category">#&nbsp;Kotlin</a> <a href="/tags/%E5%8D%8F%E7%A8%8B/" class="post-footer-tag">#&nbsp;协程</a> <a href="/tags/flow/" class="post-footer-tag">#&nbsp;flow</a></div><div class="nav"><div class="nav-item-prev"><a href="/2023/06/05/flow-2/" class="nav-link"><div><div class="nav-label">上一篇</div><div class="nav-title">SharedFlow、StateFlow、SafeFlow的区别</div></div></a></div><div class="nav-item-next"><a href="/2023/04/29/coroutine-context/" class="nav-link"><div><div class="nav-label">下一篇</div><div class="nav-title">协程上下文CoroutineContext</div></div></a></div></div><div class="card card-content toc-card" id="mobiletoc"><div class="toc-header">目录</div><ol class="toc"><li class="toc-item toc-level-2"><a href="#%E7%94%9F%E6%88%90%E6%95%B0%E6%8D%AE%E6%B5%81" class="toc-link"><span class="toc-text">生成数据流</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a href="#flow" class="toc-link"><span class="toc-text">flow</span></a></li><li class="toc-item toc-level-3"><a href="#asFlow" class="toc-link"><span class="toc-text">asFlow</span></a></li><li class="toc-item toc-level-3"><a href="#flowOf" class="toc-link"><span class="toc-text">flowOf</span></a></li></ol></li><li class="toc-item toc-level-2"><a href="#%E6%94%B6%E9%9B%86%E6%95%B0%E6%8D%AE%E6%B5%81" class="toc-link"><span class="toc-text">收集数据流</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a href="#collect%E3%80%81collectIndexed" class="toc-link"><span class="toc-text">collect、collectIndexed</span></a></li><li class="toc-item toc-level-3"><a href="#collectLatest" class="toc-link"><span class="toc-text">collectLatest</span></a></li><li class="toc-item toc-level-3"><a href="#reduce" class="toc-link"><span class="toc-text">reduce</span></a></li><li class="toc-item toc-level-3"><a href="#fold" class="toc-link"><span class="toc-text">fold</span></a></li><li class="toc-item toc-level-3"><a href="#single%E3%80%81singleOrNull" class="toc-link"><span class="toc-text">single、singleOrNull</span></a></li><li class="toc-item toc-level-3"><a href="#first%E3%80%81firstOrNull%E3%80%81last%E3%80%81lastOrNull" class="toc-link"><span class="toc-text">first、firstOrNull、last、lastOrNull</span></a></li></ol></li><li class="toc-item toc-level-2"><a href="#%E8%BD%AC%E6%8D%A2%E6%95%B0%E6%8D%AE%E6%B5%81" class="toc-link"><span class="toc-text">转换数据流</span></a></li></ol></div></main><aside class="right-column"><div class="sticky-widescreen"><article class="card card-content"><div class="recent-posts-card"><div class="recent-posts-header">相关文章</div><div class="recent-posts-list"><div class="recent-posts-item"><div class="recent-posts-item-title">2023-07-11</div><a href="/2023/07/11/coroutine-2/"><div class="recent-posts-item-content">Kotlin协程的实现</div></a></div><div class="recent-posts-item recent-posts-item-other"><div class="recent-posts-item-title">2023-06-05</div><a href="/2023/06/05/flow-2/"><div class="recent-posts-item-content">SharedFlow、StateFlow、SafeFlow的区别</div></a></div><div class="recent-posts-item recent-posts-item-other"><div class="recent-posts-item-title">2023-04-29</div><a href="/2023/04/29/coroutine-context/"><div class="recent-posts-item-content">协程上下文CoroutineContext</div></a></div><div class="recent-posts-item recent-posts-item-other"><div class="recent-posts-item-title">2023-03-15</div><a href="/2023/03/15/coroutine-1/"><div class="recent-posts-item-content">Kotlin协程的使用</div></a></div><div class="recent-posts-item recent-posts-item-other"><div class="recent-posts-item-title">2023-02-24</div><a href="/2023/02/24/kotlin-note/"><div class="recent-posts-item-content">Kotlin使用笔记</div></a></div></div></div></article><article class="card card-content"><div class="recent-posts-card"><div class="recent-posts-header">最近文章</div><div class="recent-posts-list"><div class="recent-posts-item"><div class="recent-posts-item-title">2024-08-16</div><a href="/2024/08/16/flutter-canvas/"><div class="recent-posts-item-content">Flutter自定义绘制CustomPaint</div></a></div><div class="recent-posts-item recent-posts-item-other"><div class="recent-posts-item-title">2024-07-23</div><a href="/2024/07/23/flutter-getx/"><div class="recent-posts-item-content">Flutter强大脚手架-GetX</div></a></div><div class="recent-posts-item recent-posts-item-other"><div class="recent-posts-item-title">2024-06-16</div><a href="/2024/06/16/flutter-navigator/"><div class="recent-posts-item-content">Flutter界面跳转-Navigator</div></a></div><div class="recent-posts-item recent-posts-item-other"><div class="recent-posts-item-title">2024-05-02</div><a href="/2024/05/02/flutter-dart/"><div class="recent-posts-item-content">Flutter基础语言Dart</div></a></div></div></div></article></div></aside></div></div></div></div><script>let initCount=0;function initClipboard(){++initCount<2||new ClipboardJS(".btn-copy").on("success",function(n){n.clearSelection(),n.trigger.innerHTML=icon_yes,setTimeout(()=>{n.trigger.innerHTML=icon_copy},1e3)})}var addLazyload=function(){lozad(".lozad",{load:function(n){n.srcset=n.getAttribute("data-src")},loaded:function(n){n.classList.add("loaded")}}).observe()}</script><script>loadScript("/js/lib/lozad.min.js",addLazyload)</script><script>loadScript("/js/lib/toc-highlight-scroll.min.js",()=>{tocSetup(),addCopyButton(),initClipboard()})</script><script>loadScript("/js/lib/clipboard.min.js",()=>initClipboard())</script></body></html>